repositoryType: vertica
useMiddleware: true

roles:
   users: [som-user,monitoring-user]
   delegates: [som-delegate,monitoring-delegate]

http:
  port: 8080 #Note that until dropwizard 0.7.0 there is no support for privileged ports
  adminPort: 8081
  maxThreads: 1024
  minThreads: 32
  connectorType: nonblocking+ssl

  contextParameters:
     ServerVIP: <%= @creds[:context_params][:server_vip] %>
     ServerPort: 35357
     ConnTimeout: 500
     ServiceIds: 230,260
     Endpoints: 2301,2601,2602
     ConnSSLClientAuth: True
     Keystore: /etc/ssl/hpmiddleware-keystore.jks
     KeystorePass: <%= @creds[:context_params][:keystore_password]%>
     Truststore: /etc/ssl/hpmiddleware-truststore.jks
     TruststorePass: <%= @creds[:context_params][:truststore_password] %> 
     ConnPoolMaxActive: 3
     ConnPoolMaxIdle: 3
     ConnPoolEvictPeriod: 60000
     ConnPoolMinIdleTime: 90000
     DelayAuthDecision: False
     AuthVersion: v3
     EHCacheConfig: ehCacheConfig.xml
  ssl:
    keyStore: /etc/ssl/som-api-keystore.jks
    keyStorePassword: <%= @keystore_pass %>
    supportedProtocols: ["SSLv2Hello", "SSLv3", "TLSv1", "TLSv1.1", "TLSv1.2"]

  requestLog:
    console:
      enabled: false
    file:
      enabled: true
      currentLogFilename: /var/log/som-api/requests.log
      archivedLogFilenamePattern: /var/log/som-api/requests-%d.log.gz
      archivedFileCount: 32

database:
  driverClass: com.vertica.jdbc.Driver
  url: jdbc:vertica://<%= @creds[:db][:host][node[:fqdn]] %>:5433/som
  user: <%= @creds[:db][:user] %>
  password: "<%= @creds[:db][:password] %>"
  properties:
    charSet: UTF-8
    ssl: true

  # The maximum amount of time to wait on an empty pool before throwing an exception
  maxWaitForConnection: 1s

  # The SQL vertica to run when validating a connection's liveness
  validationQuery: "/* MyService Health Check */ SELECT 1"

  # The minimum number of connections to keep open
  minSize: 8

  # The maximum number of connections to keep open
  maxSize: 64

  # Whether or not idle connections should be validated
  checkConnectionWhileIdle: false

  # How long a connection must be held before it can be validated
  checkConnectionHealthWhenIdleFor: 10s

  # The maximum lifetime of an idle connection
  closeConnectionIfIdleFor: 1 minute

logging:
  # Options: DEBUG, TRACE, WARN, INFO
  level: INFO

  console:
    enabled: false

  file:
    enabled: true
    # Do not write log statements below this threshold to the file
    threshold: ALL
    # The file to which statements will be logged
    currentLogFilename: /var/log/som-api/som-api.log
    archivedLogFilenamePattern: /var/log/som-api/som-api%d.log.gz
    # The maximum number of log files to archive
    archivedFileCount: 10
